

## âœ… Final Instruction for Claude 4.0 Sonnet

### ðŸ§  Chat Threads Must Behave Like ChatGPT

> ### ðŸŽ¯ Objective:
>
> Please make sure that the **chat thread system behaves like ChatGPTâ€™s thread-based model**, where:
>
> * âœ… **Starting a new chat** clears the output box completely.
> * âœ… **Each thread has its own message history.**
> * âœ… **Messages from one thread do not appear in another.**
> * âœ… **Switching threads instantly shows only that threadâ€™s messages.**
> * âœ… **Chat output and typing animation reset on thread switch or new chat.**
>
> ---
>
> ### ðŸ”§ Files to Modify:
>
> * `public/script.js`: Fix how threads are loaded, displayed, and how new chats are handled.
> * `server.js`: Ensure thread-specific message handling.
> * `user_threads.json`: Threads must contain isolated message arrays tied to a `threadId`.
>
> ---
>
> ### âœ… Expected Behavior (Match ChatGPT):
>
> | Action                   | Result                                                |
> | ------------------------ | ----------------------------------------------------- |
> | Click â€œNew Chatâ€         | Output clears. New message saved to new empty thread. |
> | Switch to another thread | Output changes to that threadâ€™s messages only.        |
> | Send message             | Only stored in selected threadâ€™s history.             |
> | Refresh browser          | Last selected thread reloads if user is logged in.    |
> | Logout/Login             | Correct threads/messages load for that user only.     |
>
> ---
>
> ### ðŸ§± Suggested Data Structure per Thread:
>
> ```json
> {
>   "id": "thread-uuid",
>   "title": "Auto-generated summary",
>   "messages": [
>     { "role": "user", "content": "What's a sales funnel?" },
>     { "role": "assistant", "content": "A sales funnel is..." }
>   ]
> }
> ```
>
> ---
>
> ### âš ï¸ Do NOT:
>
> * Do not allow message display to persist between threads.
> * Do not append new chat messages to previous threads.
> * Do not affect any styling, authentication, or unrelated features.
>
> ---
>
> ### ðŸ“‹ Manual Testing Scenarios:
>
> * âœ… Start New Chat â†’ No previous messages shown
> * âœ… Switch threads â†’ See only that threadâ€™s messages
> * âœ… Logout â†’ Output clears
> * âœ… Log back in â†’ Proper thread list and message history loads
> * âœ… Refresh while inside a thread â†’ That thread reloads cleanly
>
> ---
>
> ### ðŸ“¦ After Task Completion:
>
> Please give a short summary that includes:
>
> * Files changed
> * Main logic added or changed
> * Any assumptions you made
> * Confirmation that behavior now matches ChatGPT-style threads

